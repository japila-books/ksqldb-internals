{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+","tags":false},"docs":[{"location":"","text":"<p>Welcome to The Internals of ksqlDB online book! \ud83e\udd19</p> <p>I'm Jacek Laskowski, an IT freelancer specializing in Apache Spark, Delta Lake, Apache Kafka and Kafka Streams (with brief forays into a wider data engineering space, e.g. Trino and ksqlDB, mostly during Warsaw Data Engineering meetups).</p> <p>I'm very excited to have you here and hope you will enjoy exploring the internals of ksqlDB as much as I have.</p>  <p>Flannery O'Connor</p> <p>I write to discover what I know.</p>   \"The Internals Of\" series <p>I'm also writing other online books in the \"The Internals Of\" series. Please visit \"The Internals Of\" Online Books home page.</p>  <p>Expect text and code snippets from a variety of public sources. Attribution follows.</p> <p>Now, let's take a deep dive into ksqlDB \ud83d\udd25</p>  <p>Last update: 2021-12-05</p>","title":"The Internals of ksqlDB 0.22.0"},{"location":"DefaultKsqlParser/","text":"<p><code>DefaultKsqlParser</code> is a KsqlParser.</p>","title":"DefaultKsqlParser"},{"location":"DefaultKsqlParser/#creating-instance","text":"<p><code>DefaultKsqlParser</code> takes no arguments to be created.</p> <p><code>DefaultKsqlParser</code> is created when:</p> <ul> <li><code>Cli</code> is created</li> <li><code>EngineContext</code> utility is used to create an EngineContext and createSandbox</li> <li><code>KsqlResource</code> is requested for TERMINATE_CLUSTER</li> </ul>","title":"Creating Instance"},{"location":"DefaultKsqlParser/#parse","text":"","title":"parse <pre><code>List&lt;ParsedStatement&gt; parse(\n  String sql)\n</code></pre> <p><code>parse</code>...FIXME</p> <p><code>parse</code> is part of the KsqlParser abstraction.</p>"},{"location":"EngineContext/","text":"","title":"EngineContext"},{"location":"EngineContext/#parse","text":"","title":"parse <pre><code>List&lt;ParsedStatement&gt; parse(\n  String sql)\n</code></pre> <p><code>parse</code> requests the KsqlParser to parse the SQL text.</p> <p><code>parse</code> is used when:</p> <ul> <li><code>EngineContext</code> is requested to substituteVariables</li> <li><code>KsqlEngine</code> is requested to parse a SQL text</li> <li><code>SandboxedExecutionContext</code> is requested to <code>parse</code></li> </ul>"},{"location":"KsqlConfig/","text":"","title":"KsqlConfig"},{"location":"KsqlConfig/#ksqlvariablesubstitutionenable","text":"","title":"ksql.variable.substitution.enable <p>Enables variable substitution on SQL statements</p> <p>Default: <code>true</code></p> <p>Used when:</p> <ul> <li><code>Cli</code> is requested to <code>isVariableSubstitutionEnabled</code></li> <li><code>RequestHandler</code> is requested to <code>isVariableSubstitutionEnabled</code></li> <li><code>RequestValidator</code> is requested to <code>isVariableSubstitutionEnabled</code></li> </ul>"},{"location":"KsqlEngine/","text":"","title":"KsqlEngine"},{"location":"KsqlEngine/#creating-instance","text":"<p><code>KsqlEngine</code> takes the following to be created:</p> <ul> <li> ServiceContext <li> ProcessingLogContext <li> Service ID <li> MutableMetaStore <li> <code>Function&lt;KsqlEngine, KsqlEngineMetrics&gt;</code> <li> QueryIdGenerator <li> KsqlConfig <li> <code>QueryEventListener</code>s  <p><code>KsqlEngine</code> is created when:</p> <ul> <li><code>KsqlContext</code> is requested to create</li> <li><code>KsqlRestApplication</code> is requested to buildApplication</li> <li><code>StandaloneExecutorFactory</code> is requested to create</li> </ul>","title":"Creating Instance"},{"location":"KsqlEngine/#parsing-sql-text","text":"","title":"Parsing SQL Text <pre><code>List&lt;ParsedStatement&gt; parse(\n  String sql)\n</code></pre> <p><code>parse</code>...FIXME</p> <p><code>parse</code> is part of the KsqlExecutionContext abstraction.</p>"},{"location":"KsqlExecutionContext/","text":"<p><code>KsqlExecutionContext</code> is an abstraction of execution contexts.</p>","title":"KsqlExecutionContext"},{"location":"KsqlExecutionContext/#contract-subset","text":"","title":"Contract (Subset)"},{"location":"KsqlExecutionContext/#parsing-sql-text","text":"","title":"Parsing SQL Text <pre><code>List&lt;ParsedStatement&gt; parse(\n  String sql)\n</code></pre> <p>Used when:</p> <ul> <li><code>KsqlContext</code> is requested to sql</li> <li><code>SqlFormatInjector</code> is requested to <code>inject</code></li> <li><code>QueryEndpoint</code> is requested to <code>createStatement</code></li> <li><code>KsqlRestApplication</code> is requested to registerCommandTopic</li> <li><code>StandaloneExecutor</code> is requested to processesQueryFile</li> <li><code>StatementParser</code> is requested to <code>parseSingleStatement</code></li> <li><code>KsqlResource</code> is requested to handleKsqlStatements</li> </ul>"},{"location":"KsqlExecutionContext/#implementations","text":"<ul> <li>KsqlEngine</li> <li>SandboxedExecutionContext</li> </ul>","title":"Implementations"},{"location":"KsqlParser/","text":"<p><code>KsqlParser</code> is an abstraction of SQL parsers.</p>","title":"KsqlParser"},{"location":"KsqlParser/#contract","text":"","title":"Contract"},{"location":"KsqlParser/#parse","text":"","title":"parse <pre><code>List&lt;ParsedStatement&gt; parse(\n  String sql)\n</code></pre> <p>Used when:</p> <ul> <li><code>Cli</code> is requested to substituteVariables and handleStatements</li> <li><code>EngineContext</code> is requested to parse a SQL statement</li> <li><code>KsqlResource</code> is requested for TERMINATE_CLUSTER</li> </ul>"},{"location":"KsqlParser/#prepare","text":"","title":"prepare <pre><code>PreparedStatement&lt;?&gt; prepare(\n  ParsedStatement statement,\n  TypeRegistry typeRegistry)\n</code></pre>"},{"location":"KsqlParser/#implementations","text":"<ul> <li>DefaultKsqlParser</li> </ul>","title":"Implementations"},{"location":"SandboxedExecutionContext/","text":"<p><code>SandboxedExecutionContext</code> is...FIXME</p>","title":"SandboxedExecutionContext"},{"location":"overview/","text":"<p>ksqlDB is \"the database purpose-built for stream processing applications.\"</p> <p>ksqlDB uses Ksql (via <code>ksql</code> shell script) as the command-line interactive environment.</p> <pre><code>$ ./bin/ksql\nksql&gt;\n</code></pre>","title":"ksqlDB"},{"location":"cli/Cli/","text":"","title":"Cli"},{"location":"cli/Cli/#runcommand","text":"","title":"runCommand <pre><code>void runCommand(\n  String command)\n</code></pre> <p><code>runCommand</code> handleLine.</p> <p><code>runCommand</code> is used when:</p> <ul> <li><code>Ksql</code> is requested to run</li> </ul>"},{"location":"cli/Cli/#runinteractively","text":"","title":"runInteractively <pre><code>void runInteractively()\n</code></pre> <p><code>runInteractively</code>...FIXME</p> <p><code>runInteractively</code> is used when:</p> <ul> <li><code>Ksql</code> is requested to run</li> </ul>"},{"location":"cli/Cli/#handleline","text":"","title":"handleLine <pre><code>void handleLine(\n  String line)\n</code></pre> <p><code>handleLine</code> removes any leading and trailing spaces from the given <code>line</code> and handleStatements.</p> <p><code>handleLine</code> simply returns back when the given <code>line</code> is empty after trimming.</p> <p><code>handleLine</code> is used when:</p> <ul> <li><code>Cli</code> is requested to runScript, runCommand, runInteractively</li> </ul>"},{"location":"cli/Cli/#handlestatements","text":"","title":"handleStatements <pre><code>void handleStatements(\n  String line)\n</code></pre> <p><code>handleStatements</code> requests the DefaultKsqlParser to parse the given line (into <code>ParsedStatement</code>s).</p>  <p>Note</p> <p>There could be one or more <code>ParsedStatement</code>s in the given <code>line</code>.</p>  <p>For every <code>ParsedStatement</code>, <code>handleStatements</code> substituteVariables and...FIXME</p> <p><code>handleStatements</code>...FIXME</p>"},{"location":"cli/Cli/#substitutevariables","text":"","title":"substituteVariables <pre><code>ParsedStatement substituteVariables(\n  ParsedStatement statement)\n</code></pre> <p><code>substituteVariables</code>...FIXME</p>"},{"location":"cli/Cli/#isvariablesubstitutionenabled","text":"","title":"isVariableSubstitutionEnabled <pre><code>boolean isVariableSubstitutionEnabled()\n</code></pre> <p><code>isVariableSubstitutionEnabled</code>...FIXME</p>"},{"location":"cli/Ksql/","text":"<p><code>Ksql</code> is a standalone (command-line) application that can be launched using <code>ksql</code> shell script (or <code>ksql-run-class</code>).</p> <pre><code>./bin/ksql-run-class io.confluent.ksql.Ksql\n</code></pre>","title":"Ksql"},{"location":"cli/Ksql/#launching-command-line-application","text":"","title":"Launching Command-Line Application <p><code>main</code>...FIXME</p>"},{"location":"cli/Ksql/#run","text":"","title":"run <pre><code>void run()\n</code></pre> <p><code>run</code>...FIXME</p>"},{"location":"embedded/EmbeddedKsql/","text":"<p><code>EmbeddedKsql</code> is a standalone (command-line) application.</p>","title":"EmbeddedKsql"},{"location":"embedded/KsqlContext/","text":"","title":"KsqlContext"},{"location":"embedded/KsqlContext/#creating-instance","text":"<p><code>KsqlContext</code> takes the following to be created:</p> <ul> <li> ServiceContext <li> KsqlConfig <li> KsqlEngine <li> <code>BiFunction&lt;KsqlExecutionContext, ServiceContext, Injector&gt;</code>  <p><code>KsqlContext</code> is created when:</p> <ul> <li><code>KsqlContext</code> utility is used to create a KsqlContext</li> </ul>","title":"Creating Instance"},{"location":"embedded/KsqlContext/#creating-ksqlcontext","text":"","title":"Creating KsqlContext <pre><code>KsqlContext create(\n  KsqlConfig ksqlConfig,\n  ProcessingLogContext processingLogContext)\n</code></pre> <p><code>create</code>...FIXME</p> <p><code>create</code> is used when:</p> <ul> <li>EmbeddedKsql standalone application is launched</li> </ul>"},{"location":"rest/CustomExecutors/","text":"<p><code>CustomExecutors</code> is a collection of StatementExecutors that do not need to be distributed.</p> <p>    Enum Name Class StatementExecutor     <code>DESCRIBE_STREAMS</code> <code>DescribeStreams</code> <code>ListSourceExecutor::describeStreams</code>   <code>DESCRIBE_TABLES</code> <code>DescribeTables</code> <code>ListSourceExecutor::describeTables</code>   <code>LIST_CONNECTORS</code> <code>ListConnectors</code> <code>ListConnectorsExecutor::execute</code>   <code>LIST_CONNECTOR_PLUGINS</code> <code>ListConnectorPlugins</code> <code>ListConnectorPluginsExecutor::execute</code>   <code>LIST_FUNCTIONS</code> <code>ListFunctions</code> <code>ListFunctionsExecutor::execute</code>   <code>LIST_PROPERTIES</code> <code>ListProperties</code> <code>ListPropertiesExecutor::execute</code>   <code>LIST_QUERIES</code> <code>ListQueries</code> <code>ListQueriesExecutor::execute</code>   <code>LIST_STREAMS</code> <code>ListStreams</code> <code>ListSourceExecutor::streams</code>   <code>LIST_TABLES</code> <code>ListTables</code> <code>ListSourceExecutor::tables</code>   <code>LIST_TOPICS</code> <code>ListTopics</code> <code>ListTopicsExecutor::execute</code>   <code>LIST_TYPES</code> <code>ListTypes</code> <code>ListTypesExecutor::execute</code>   <code>LIST_VARIABLES</code> <code>ListVariables</code> <code>ListVariablesExecutor::execute</code>   others","title":"CustomExecutors"},{"location":"rest/CustomExecutors/#executor_map","text":"","title":"EXECUTOR_MAP <p><code>CustomExecutors</code> defines a lookup table of StatementExecutors by their class types.</p>"},{"location":"rest/KsqlResource/","text":"","title":"KsqlResource"},{"location":"rest/KsqlResource/#requesthandler","text":"","title":"RequestHandler <p><code>KsqlResource</code> creates a <code>RequestHandler</code> when requested to configure.</p> <p><code>RequestHandler</code> is used when:</p> <ul> <li>terminateCluster</li> <li>handleKsqlStatements</li> </ul>"},{"location":"rest/KsqlResource/#handleksqlstatements","text":"","title":"handleKsqlStatements <pre><code>EndpointResponse handleKsqlStatements(\n  KsqlSecurityContext securityContext,\n  KsqlRequest request)\n</code></pre> <p><code>handleKsqlStatements</code> prints out the following INFO message to the logs:</p> <pre><code>Received: [request]\n</code></pre> <p><code>handleKsqlStatements</code>...FIXME</p> <p><code>handleKsqlStatements</code> requests the KsqlEngine to parse the SQL text.</p> <p><code>handleKsqlStatements</code>...FIXME</p> <p><code>handleKsqlStatements</code> requests the RequestHandler to execute the SQL statements.</p> <p><code>handleKsqlStatements</code>...FIXME</p> <p><code>handleKsqlStatements</code> is used when:</p> <ul> <li><code>KsqlServerEndpoints</code> is requested to <code>executeKsqlRequest</code></li> <li><code>ServerInternalKsqlClient</code> is requested to <code>makeKsqlRequest</code></li> </ul>"},{"location":"rest/KsqlRestApplication/","text":"<p><code>KsqlRestApplication</code> is a ksqlDB API server.</p>","title":"KsqlRestApplication"},{"location":"rest/KsqlRestApplication/#creating-instance","text":"<p><code>KsqlRestApplication</code> takes the following to be created:</p> <ul> <li> ServiceContext <li> KsqlEngine <li> KsqlConfig <li> KsqlRestConfig <li> CommandRunner <li> CommandStore <li> StatusResource <li> StreamedQueryResource <li> KsqlResource <li> VersionCheckerAgent <li> KsqlSecurityContextProvider <li> KsqlSecurityExtension <li> AuthenticationPlugin <li> ServerState <li> ProcessingLogContext <li> <code>KsqlServerPrecondition</code>s <li> <code>KsqlConfigurable</code>s <li> <code>Consumer&lt;KsqlConfig&gt;</code> <li> <code>HeartbeatAgent</code> <li> <code>LagReportingAgent</code> <li> Vertx <li> DenyListPropertyValidator <li> <code>PullQueryExecutorMetrics</code> <li> <code>ScalablePushQueryMetrics</code> <li> <code>LocalCommands</code> <li> QueryExecutor   <p>When created, <code>KsqlRestApplication</code> prints out the following DEBUG message to the logs:</p> <pre><code>Creating instance of ksqlDB API server\n</code></pre> <p>In the end, <code>KsqlRestApplication</code> prints out the following DEBUG message to the logs:</p> <pre><code>ksqlDB API server instance created\n</code></pre>  <p><code>KsqlRestApplication</code> is created when:</p> <ul> <li><code>KsqlRestApplication</code> utility is used to buildApplication</li> </ul>","title":"Creating Instance"},{"location":"rest/KsqlRestApplication/#buildapplication","text":"","title":"buildApplication <pre><code>KsqlRestApplication buildApplication(\n  KsqlRestConfig restConfig)\nKsqlRestApplication buildApplication(\n  String metricsPrefix,\n  KsqlRestConfig restConfig,\n  Function&lt;Supplier&lt;Boolean&gt;, VersionCheckerAgent&gt; versionCheckerFactory,\n  int maxStatementRetries,\n  ServiceContext serviceContext,\n  Supplier&lt;SchemaRegistryClient&gt; schemaRegistryClientFactory,\n  Vertx vertx,\n  KsqlClient sharedClient)\n</code></pre> <p><code>buildApplication</code>...FIXME</p> <p><code>buildApplication</code> is used when:</p> <ul> <li><code>KsqlServerMain</code> is requested to createExecutable</li> </ul>"},{"location":"rest/KsqlServerMain/","text":"<p><code>KsqlServerMain</code> is a standalone (command-line) application.</p>","title":"KsqlServerMain"},{"location":"rest/KsqlServerMain/#creating-instance","text":"<p><code>KsqlServerMain</code> takes the following to be created:</p> <ul> <li> <code>Executable</code> <li> Shutdown Handler  <p><code>KsqlServerMain</code> is created when:</p> <ul> <li><code>KsqlServerMain</code> standalone application is launched</li> </ul>","title":"Creating Instance"},{"location":"rest/KsqlServerMain/#launching-ksqlservermain","text":"","title":"Launching KsqlServerMain <p><code>main</code> creates a ServerOptions from the command-line arguments.</p> <p><code>main</code>...FIXME</p>"},{"location":"rest/KsqlServerMain/#creating-executable","text":"","title":"Creating Executable <pre><code>Executable createExecutable(\n  Map&lt;String, String&gt; properties,\n  Optional&lt;String&gt; queriesFile,\n  String installDir,\n  KsqlConfig ksqlConfig)\n</code></pre> <p>With queriesFile specified, <code>createExecutable</code> creates a StandaloneExecutor.</p> <p>Otherwise, <code>createExecutable</code>...FIXME</p>"},{"location":"rest/RequestHandler/","text":"","title":"RequestHandler"},{"location":"rest/RequestHandler/#creating-instance","text":"<p><code>RequestHandler</code> takes the following to be created:</p> <ul> <li> CustomExecutors <li> <code>DistributingExecutor</code> <li> KsqlEngine <li> <code>CommandQueueSync</code>  <p><code>RequestHandler</code> is created when:</p> <ul> <li><code>KsqlResource</code> is requested to configure</li> </ul>","title":"Creating Instance"},{"location":"rest/RequestHandler/#distributingexecutor","text":"","title":"DistributingExecutor <p><code>RequestHandler</code> is given a <code>DistributingExecutor</code> when created.</p> <p>The <code>DistributingExecutor</code> is used when executeStatement.</p>"},{"location":"rest/RequestHandler/#executing-sql-statements","text":"","title":"Executing SQL Statements <pre><code>KsqlEntityList execute(\n  KsqlSecurityContext securityContext,\n  List&lt;ParsedStatement&gt; statements,\n  SessionProperties sessionProperties)\n</code></pre> <p><code>execute</code>...FIXME</p> <p><code>execute</code> executes the SQL statement.</p> <p><code>execute</code>...FIXME</p> <p><code>execute</code> is used when:</p> <ul> <li><code>KsqlResource</code> is requested to terminateCluster and handleKsqlStatements</li> </ul>"},{"location":"rest/RequestHandler/#executestatement","text":"","title":"executeStatement <pre><code>&lt;T extends Statement&gt; Optional&lt;KsqlEntity&gt; executeStatement(\n  KsqlSecurityContext securityContext,\n  PreparedStatement&lt;T&gt; prepared,\n  SessionProperties sessionProperties,\n  KsqlEntityList entities)\n</code></pre> <p><code>executeStatement</code>...FIXME</p>"},{"location":"rest/ServerOptions/","text":"","title":"ServerOptions"},{"location":"rest/ServerOptions/#query-file","text":"","title":"Query File <p>Query file option is a path to a query file on the local machine.</p> <p>A query file can be specified using the following (in the order of precedence):</p> <ol> <li><code>--queries-file</code> command-line option</li> <li><code>ksql.queries.file</code> Java property</li> </ol>"},{"location":"rest/StandaloneExecutor/","text":"<p><code>StandaloneExecutor</code> is...FIXME</p>","title":"StandaloneExecutor"},{"location":"rest/StandaloneExecutorFactory/","text":"","title":"StandaloneExecutorFactory"},{"location":"rest/StandaloneExecutorFactory/#creating-standaloneexecutor","text":"","title":"Creating StandaloneExecutor <pre><code>StandaloneExecutor create(\n  Map&lt;String, String&gt; properties,\n  String queriesFile,\n  String installDir)\n</code></pre> <p><code>create</code>...FIXME</p> <p><code>create</code> is used when:</p> <ul> <li><code>KsqlServerMain</code> is requested to createExecutable (with a queries file)</li> </ul>"},{"location":"rest/Statement/","text":"<p><code>Statement</code> is...FIXME</p>","title":"Statement"},{"location":"rest/StatementExecutor/","text":"<p><code>StatementExecutor</code> is an abstraction of executors of Statements.</p> <p><code>StatementExecutor</code> is a <code>FunctionalInterface</code> (Java).</p>","title":"StatementExecutor"},{"location":"rest/StatementExecutor/#contract","text":"","title":"Contract"},{"location":"rest/StatementExecutor/#executing-statement","text":"","title":"Executing Statement <pre><code>StatementExecutorResponse execute(\n  ConfiguredStatement&lt;T&gt; statement,\n  SessionProperties sessionProperties,\n  KsqlExecutionContext executionContext,\n  ServiceContext serviceContext)\n</code></pre> <p>Used when:</p> <ul> <li><code>CustomExecutors</code> is requested to execute</li> <li><code>RequestHandler</code> is requested to execute a SQL statement</li> </ul>"},{"location":"rest/StatementExecutor/#implementations","text":"<ul> <li>many</li> </ul>","title":"Implementations"}]}